---
title: Gli strati geografici
day: 2
---
Layer e sorgenti
================
In OpenLayers gli strati geografici vengono gestiti tramite oggetti di tipo `ol.layer.Layer`. Concretamente però non utilizziamo questo oggetto ma le varie classi derivate, ognuna specializzata nella gestione di strati raster, immagini, vettoriali, tile, ecc. I tipi di layer più comunemente usati sono:

* **ol.layer.Image**, per l'impiego di immagini statiche o servite da server, come nel caso di servizi OGC WMS
* **ol.layer.Tile**, per la definizione di strati con immagini "tilizzate" (tasselli), come nel caso di servizi OSM, Bing, Mapbox, o anche WMS, nel caso si voglaino interrogare a tiles
* **ol.layer.Vector** , per gli strati di tipo vettoriale

Oltre a questi tre ne esistono altri più spceifici che non andremo ad analizzare.
Nelle prossime lezioni approfondimento l'utilizzo di questi tre tipi di layer, ma intanto anticipiamo un concetto strettamente legato ai layer, e presente in ogni tipo di strato: le sorgenti.

Ogni strato ha bisogno di sapere da dove, e come recuperare i dati da rappresentare in mappa. In alcuni contesti gli oggetti dedicati a fornire l'accesso ai dati vengono detti "provider". In OL si chiamano **sources**. Quando istanziamo un layer di qualsiasi tipo + necessario passargli anche l'oggetto ti tipo ol.source.Source con cui dovrà dialogare per ottenere i dati. Per ogni tipo di sorgente a cui OL3 è in grado di accedere esiste un oggetto specializzato, che saprà cosa fare per recuperare e fornire i dati richiesti (in base a diverse strategie di cui parleremo in seguito).

I principali tipi di sorgenti usate nel corso sono:

* **ol.source.ImageWMS**, per utilizzare servizi OGC WMS
* **ol.source.XYZ**, per usare servizi con tile prerenderizzati e suddivisi per livello (z) e coordinate tile (x, y)
* **ol.source.OSM**, un ol.source.XYZ preconfigurato per l'accesso ai servizi OpenStreetMap
* **ol.source.Vector**, per l'impiego di sorgenti vettoriali, gestiti poi tramite oggetti `ol.format` di cui parleremo ampiamente

Ci sono poi sorgenti specializzare per l'utlizzo di sorgenti MVT (Mapbox Vector Tiles), dei servizi Bing, CartoDB, Stamen, ecc. Una sorgente un po' particolare è ol.source.Zoomify che permette di utilizzare OL come visualizzatore di granfi immagini fotografiche, non georiferite, secondo il formato di [Zoomify](http://www.zoomify.com/){:target="_blank"}.

# Configurazioni di un layer #
I principali parametri di configurazione di un layer sono la proiezione, la visibilità, l'opacità e i limiti di scala di visualizzazione. Se non specificati vengono assegnati dei valori di default: proiezione della mappa a cui viene aggiunto il layer, visibilità attiva, opacità massima e visualizzazione ad ogni scala.

{% highlight javascript %}
var ortofoto = new ol.layer.Image({
  source: sorgente,
  projection: ol.proj.Projection("EPSG:3003", // associo il SR Gauss Boaga Ovest,
  visible: true, // se il layer è visibile o no
  opacity: 0.5, // valore [0-1] che indica il livello di opacità
  maxResolution: 200, // risoluzione massima di visualizzazione
  minResolution: 0 // risoluzione minima di visualizzazione
});
{% endhighlight %}

**NB** Sebbene OL offra gli strumenti per poter riproiettare al volo layer vettoriali e raster, ognuno con le proprie modalità, è sempre opportuno soprattutto per le immagini utilizzare layer con SR congruente con quello della mappa, in modo da non sovraccaricare eccessivamente il lavoro che deve effettuare il browser e migliorare le performance generali del client. E' anche per questo motivo che di default OL associa al layer, se non indicato diversamente, la stessa proiezione della mappa.

Ogni proprietà di inizializzazione degli oggetti di OL può essere alterata e ottenuta tramite i relativi metodi esposti dall'API dell'oggetto. Generalmente i metodi per ottenere e definire il valore di una proprietà `xxx` di un oggetto sono `oggetto.getXxx` e `oggetto.setXxx` (prima lettere del nome della proprietà in maiuscolo).

Qui sotto potete vedere un esempio in azione, nel quale 

* modifichiamo una proprietà di `ol.View` a sua volta ottenuta da `ol.Map`
* modifichiamo due proprietà del nostro `ol.layer.Image` _ortofoto_.

{% highlight javascript %}
map.getView().setZoom(17); // ottengo la ol.View della mappa e setto il nuovo livello di zoom
ortofoto.setOpacity(0.5); // setto un'opacità l 50%
ortofoto.setMaxResolution(19); // imposto la risoluzione massima (livello di zoom 13) entro la quale visualizzare il layer
{% endhighlight %}

{% include jsfiddle.html id="cvjg4zm5" tabs="result,html" %}
